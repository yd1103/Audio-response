<!doctype html>
<html>
<head>
    <title>CEL EXPERIMENT 2020</title>

    <script src="js/jquery.min.js"></script>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-text.js"></script>
    <script src="jspsych/plugins/jspsych-button-response.js"></script>
    <script src="jspsych/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych/plugins/jspsych-single-stim.js"></script>
    <script src="jspsych/plugins/jspsych-single-audio.js"><</script>
    <script src="jspsych/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jspsych/plugins/jspsych-html.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>

    <style>
        html {
            text-align: center;
            font-family: 'Open Sans', 'Arial', sans-serif;
            font-size: 24px;
            line-height: 1.6em;
            height: 100%;
        }
        div{
            background: #000;
        }
        #jspsych-survey-text-next { text-align: center; font-size: 16px; height: 50px; width: 140px; }
        #jspsych-button-response-button-0 {
            text-align: center;
            font-size: 16px; height: 50px; width: 140px; }
        #jspsych-button-response-button-1 { text-align: center; font-size: 16px; position:relative; left: 15px;
            height: 50px; width: 140px; }
        .jspsych-survey-text-question textarea { text-align: center; font-size: 32px; }
    </style>

</head>
<body>

</body>
<script>

    // Filename and filedata information needs to be sent by the javascript that runs jspsych
    function saveData(filename, filedata){
        $.ajax({
            type:'post',
            cache: false,
            url: 'save_data.php', // this is the path to the above PHP script
            data: {filename: filename, filedata: filedata}
        });
    }

    // This is the timeline that our study will follow. We will push blocks into it.
    var timeline = [];
    //--------------------------------- Participant Info--------------------------------------------------------
    //makes the trials of adding numbers with text response

    var partQs = {
        type: 'survey-text',
        questions: ["Participant Number", "Experimenter", "Test Room"]
    };
    timeline.push(partQs);
    var participantNo = prompt("Enter Participant Number:");
    var participantNumber = Number(participantNo);

    //---------------------------------------------Instructions----------------------------------------------------------------
    var instruction_block = {
        type:'html',
        url: "numbers_instructions.html",
        cont_btn: "start"
    };

    timeline.push (instruction_block);

    //---------------------------------------------Practice Blocks-------------------------------------------------------------

    var sounds = ['audio/autumn_cut1.wav', 'audio/autumn_cut2.wav'];

    var sound_trial = {
        type: 'single-audio',
        stimulus: sounds[0],
        prompt: "Hit Space to Begin"
    };

    timeline.push(sound_trial);

    for(j=0; j<9; j=j+1) {
        var practice_warning = {
            type: 'single-stim',
            choices: ['Active','Passive'],
            is_html: true,
            timing_response: 2000,
            response_ends_trial: false
        };

        timeline.push(practice_warning);

        var practice_trial_response = {
            type: 'survey-text',
            questions: ['Recall the list in order. (no spaces or commas)'],
        };

        timeline.push(practice_trial_response);
    }

    //--------------------------------------------------------Debriefing-------------------------------------------------------

    var debrief_block = {
        type: 'button-response',
        choices: ['Finish'],
        is_html: true,
        stimulus: '<div><p style="text-align:center">DEBRIEFING</p><div><p style="text-align:left">Thank you for your participation. The study is now over.' +
        ' </p><p style="text-align:left">' +
        'Please click \'Finish\' to end the study and save your data. If you have any questions, please feel free to ask the experimenter. </p></div>'
    };
    timeline.push (debrief_block);

    //----------------------------------------------------Running the Timeline-------------------------------------------------

    jsPsych.init({
        timeline: timeline,
        fullscreen: true,
        use_webaudio: false,
        preload_audio: ['audio/autumn_cut1.wav','audio/autumn_cut2.wav','audio/autumn1.wav'],
        on_finish: function(data){
            // saveData("filename.csv", jsPsych.data.dataAsCSV());
            // jsPsych.data.displayData('csv');
            var currentTimeMS = Date.now();
            saveData('subject-'+participantNumber+currentTimeMS+'.csv',jsPsych.data.dataAsCSV())
        }
    });
    var time = jsPsych.totalTime();
    console.log(time);
</script>
</html>
